<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contacto | C4A</title>
  <link rel="stylesheet" href="style.css">
  <!-- Script de reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <section class="contacto-section container">
    <h2 class="section-title">Contáctanos</h2>
    <p>¿Tienes dudas, necesitas ayuda o quieres cotizar un servicio? Completa el formulario y te responderemos pronto.</p>

    <form id="contact-form">
      <input type="text" name="nombre" placeholder="Tu nombre" required>
      <input type="email" name="email" placeholder="Tu correo electrónico" required>
      
      <!-- Campo Honeypot (oculto para bots) -->
      <input type="text" name="_gotcha" style="display:none">

      <input type="text" name="empresa" placeholder="Empresa (opcional)">
      <textarea name="mensaje" placeholder="¿En qué podemos ayudarte?" required></textarea>

      <!-- Widget de reCAPTCHA v2 -->
      <div class="g-recaptcha" data-sitekey="6LeouxArAAAAAFGKIPR4VVGy0PNHyV4uc7U2QSWm"></div>

      <!-- Campos ocultos de Formspree -->
      <input type="hidden" name="_subject" value="Nuevo mensaje desde C4A.cl">
      <input type="hidden" name="_captcha" value="true">

      <button type="submit">Enviar</button>
    </form>

    <!-- Script para manejar el envío con fetch + reCAPTCHA -->
    <script>
      document.getElementById("contact-form").addEventListener("submit", async (e) => {
        e.preventDefault(); // Previene el envío tradicional

        // Validar reCAPTCHA
        const recaptchaToken = grecaptcha.getResponse();
        if (!recaptchaToken) {
          alert("¡Por favor, verifica que no eres un robot!");
          return;
        }

        // Crear FormData y adjuntar el token de reCAPTCHA
        const formData = new FormData(e.target);
        formData.append("g-recaptcha-response", recaptchaToken);

        try {
          const response = await fetch("https://formspree.io/f/mblgzwvn", {
            method: "POST",
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (response.ok) {
            alert("Mensaje enviado. ¡Gracias!");
            e.target.reset(); // Limpiar el formulario
            grecaptcha.reset(); // Resetear reCAPTCHA
          } else {
            alert("Error al enviar. Inténtalo de nuevo.");
          }
        } catch (error) {
          alert("Error de conexión. Verifica tu red.");
        }
      });
    </script>
  </section>
</body>
</html>
